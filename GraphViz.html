<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>GraphViz - Chris Maughan&#39;s Additional Storage</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Chris Maughan" name="author" /><meta content="GraphViz is an awesome way to visualize your code when debugging problems, and it is trivial to setup." name="description" /><link href="https://chrismaughan.com/GraphViz" rel="canonical" /><meta content="GraphViz" property="og:title" /><meta content="Chris Maughan&#39;s Additional Storage" property="og:site_name" /><meta content="article" property="og:type" /><meta content="GraphViz" property="neuron:zettel-id" /><meta content="GraphViz" property="neuron:zettel-slug" /><meta content="blog" property="neuron:zettel-tag" /><meta content="graphviz" property="neuron:zettel-tag" /><script type="application/ld+json">[]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(0,181,173,0.1)}body nav.bottomPane{background-color:rgba(0,181,173,2.0e-2)}body div#footnotes{border-top-color:#00b5ad}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#00b5ad;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(0,181,173,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js" integrity="sha512-vnRdmX8ZxbU+IhA2gLhZqXkX1neJISG10xy0iP0WauuClu3AIMknxyDjYHEpEhi8fTZPyOCWgqUCnEafDB/jVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js" integrity="sha512-1zKK2bG3QY2JaUPpfHZDUMe3dwBwFdCDwXQ01GrKSd+/l0hqPbF+aak66zYPUZtn+o2JYi1mjXAqy5mW04v3iA==" crossorigin="anonymous"></script>
<script>
window.addEventListener("load", function(){
  let viz = new Viz();
  for (let element of document.getElementsByClassName("graphviz")) {
    let parent = element.parentNode
    let pparent = parent.parentNode
    viz.renderSVGElement(element.textContent)
    .then(function(element) {
      element.setAttribute("width", "100%")
      pparent.replaceChild(element, parent)
    });
  }
});
</script>
<!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">GraphViz</h1><p>GraphViz is an awesome way to visualize your code when debugging problems, and it is trivial to setup.</p><p>Sometimes you need to visualize data structures in your code. GraphViz is your friend. I’ve been working on a live coding project in my spare time. This weekend I worked on a parser for the little music language I’ve been working on. Here’s an example line of code from the language:</p><p>c1 | sound(c4 e4 g4).gain(.5)</p><p>Although the language is not fully specified yet, this is a simple fragment, and enough to get me started. The language itself is an experiment based on patterns (like Tidal Cycles) - and may well be one of several different experiments I do. Briefly, this fragment means ’make a list of 3 notes (CEG), and apply .5 gain to it, then ‘pipe’ it into audio channel 1.</p><p>If you aren’t familiar with writing compilers, the basic idea is usually to decompose the code into ‘tokens’ and then build a connected tree of the tokens using a parser. The resulting data structure is called an Abstract Syntax Tree. Once you have the AST, you can use it to generate the program you want to run. The tree essentially shows you how to interpret the program. The problem we have now is to check that the tree is correct. We could just plough on and start building code fragments from the tree, but it would be nice if we could look at it.</p><p>I generate visualisations of tree structures by outputing the tree as a ‘dot’ file representation. This has been very useful on several occasions.</p><p>Dot files are a really simple format, especially if you just want a basic visualization. To build a dot file, you just list every pair of node/child links in a text file. You just need each node to have a unique Id. If you provide ‘label’ lines, you can also change the text of the node in the display - but you don’t even have to do that if the node labels are nicely formed.</p><p>Here’s an example:</p><pre><code class="language-none">digraph AST 
{
    Node_1 [label = &quot;My Node 1&quot;];
    Node_3 [label = &quot;My Node 3&quot;];
    Node_Out [label = &quot;My Node Out&quot;];

    Node_1 -&gt; Node_Out;
    Node_3 -&gt; Node_Out;
}</code></pre><p>It is trivial to write the above to debug output; assuming you can convert your node ID to a valid string, and you have a friendly name for it:</p><pre><code class="language-none">std::ostringstream str;
str &lt;&lt; &quot;digraph AST\n&quot; 

// Make the labels: not usually necessary
for(auto&amp; node : nodes)
    str &lt;&lt; to_string(node.id()) &lt;&lt; &quot; [label = \&quot;&quot; &lt;&lt; node.name() &lt;&lt; &quot;\&quot;];\n&quot;;

// Make the connections (every node to every child it has)
for auto&amp; node : nodes)
{
    for(auto&amp; child : node.children)
    {
        str &lt;&lt; to_string(node.id()) &lt;&lt; &quot;-&gt;&quot; &lt;&lt; to_string(child.id()) &lt;&lt; &quot;;\n&quot;;
    }
}

str &lt;&lt; &quot;}\n&quot;;

// Log it however you want
std::cout &lt;&lt; str.str();</code></pre><p>The great thing about this is you don’t even have to install graphviz. Just go to <a href="http://webgraphviz.com">http://webgraphviz.com</a> and paste your text. You can download graphviz instead if you need to keep your data structure private, but I mostly just paste my tests into the site. Here’s what happens if you paste the digraph into webgraphviz:</p><pre><code class="graphviz language-graphviz">std::ostringstream str;
str &lt;&lt; &quot;digraph AST\n&quot; 

// Make the labels: not usually necessary
for(auto&amp; node : nodes)
    str &lt;&lt; to_string(node.id()) &lt;&lt; &quot; [label = \&quot;&quot; &lt;&lt; node.name() &lt;&lt; &quot;\&quot;];\n&quot;;

// Make the connections (every node to every child it has)
for auto&amp; node : nodes)
{
    for(auto&amp; child : node.children)
    {
        str &lt;&lt; to_string(node.id()) &lt;&lt; &quot;-&gt;&quot; &lt;&lt; to_string(child.id()) &lt;&lt; &quot;;\n&quot;;
    }
}

str &lt;&lt; &quot;}\n&quot;;

// Log it however you want
std::cout &lt;&lt; str.str();</code></pre><p>Nice! An easy way to visualize data relationships in your code…. done. GraphViz has many more features, and you can play with some examples on the above site too. As a side-note, the graph above is automatically generated inside the blogging platform I’m using (neuron), so it is easy to add to blog posts too.</p><p>Here is an example from the code snippet above. You are seeing the finished, correct version of the AST tree here. The interesting part of this exercise in visualizing my code was that the ‘|’ and ‘.’ operators in the graph were swapped - indicating that the ‘|’ had higher precedence in my syntax parser than the ‘.’. Fixing the preference order of the operators did not immediately fix the problem either, becuase I had actually broken the AST parsing of the operators.</p><p>Short story; visualize what you are doing - it can save a lot of time! It is certainly worth the 10 minutes of effort it takes to output your data as an image.</p><p>If you want to learn more about language parsing, the LLVM tutorial is quite nice - and a good refresher for me!:</p><p><a href="https://llvm.org/docs/tutorial/">LLVM Tutorial</a></p><pre><code class="language-none">
digraph AST 
{
Id_32 [label = &quot;P:__anon__(), Fn:=&quot;];
Id_30 [label = &quot;=&quot;];
Id_22 [label = &quot;c1&quot;];
Id_29 [label = &quot;.&quot;];
Id_26 [label = &quot;pat(...)&quot;];
Id_23 [label = &quot;c4&quot;];
Id_24 [label = &quot;e4&quot;];
Id_25 [label = &quot;g4&quot;];
Id_28 [label = &quot;gain(...)&quot;];
Id_27 [label = &quot;0.5&quot;];
Id_32-&gt;Id_30;
Id_30-&gt;Id_22;
Id_30-&gt;Id_29;
Id_29-&gt;Id_26;
Id_29-&gt;Id_28;
Id_26-&gt;Id_23;
Id_26-&gt;Id_24;
Id_26-&gt;Id_25;
Id_28-&gt;Id_27;
}</code></pre><pre><code class="graphviz language-graphviz">digraph AST 
{
Id_32 [label = &quot;P:__anon__(), Fn:=&quot;];
Id_30 [label = &quot;=&quot;];
Id_22 [label = &quot;c1&quot;];
Id_29 [label = &quot;.&quot;];
Id_26 [label = &quot;pat(...)&quot;];
Id_23 [label = &quot;c4&quot;];
Id_24 [label = &quot;e4&quot;];
Id_25 [label = &quot;g4&quot;];
Id_28 [label = &quot;gain(...)&quot;];
Id_27 [label = &quot;0.5&quot;];
Id_32-&gt;Id_30;
Id_30-&gt;Id_22;
Id_30-&gt;Id_29;
Id_29-&gt;Id_26;
Id_29-&gt;Id_28;
Id_26-&gt;Id_23;
Id_26-&gt;Id_24;
Id_26-&gt;Id_25;
Id_28-&gt;Id_27;
}</code></pre></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2019-07-01">2019-07-01</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link"><a href=".">Chris Maughan’s Wiki</a></span></span><ul class="context-list" style="zoom: 85%;"></ul></li><li><span class="zettel-link-container cf"><span class="zettel-link"><a href="blog">Blog</a></span></span><ul class="context-list" style="zoom: 85%;"></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">blog</span><span class="ui basic label zettel-tag" title="Tag">graphviz</span></div></nav><nav class="ui bottom attached icon compact inverted menu teal" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/cmaughan/secondbrain/edit/master/./blog/GraphViz.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.33.0" /></a></div></div></div></body></html>